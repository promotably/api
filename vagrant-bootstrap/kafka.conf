# kafka server

description  "Kafka Server"

stop on runlevel [!2345]
respawn
respawn limit 10 5
umask 022

kill timeout 30

env RUN_AS_USER=kafka-zookeeper
env BASEDIR=/usr/local/kafka
env PIDFILE=/var/run/kafka/kafka.pid
env DAEMON=/usr/local/kafka/bin/kafka-server-start.sh
env CONFIGFILE=/usr/local/kafka/config/server.properties

pre-start script
  test -x /usr/local/kafka/bin/kafka-server-start.sh || { stop; exit 0; }
  test -c /dev/null || { stop; exit 0; }
  mkdir -p -m0755 /var/log/kafka
  chown $RUN_AS_USER /var/log/kafka
  mkdir -p -m0755 /var/run/kafka
end script

script
    exec 2>>/dev/.initramfs/myjob.log
    set -x
    /sbin/start-stop-daemon --start --make-pidfile --pidfile $PIDFILE --chuid $RUN_AS_USER --exec $DAEMON $CONFIGFILE  >> /var/log/kafka/kafka.log 2>&1
end script

pre-stop script
  /sbin/start-stop-daemon --stop --pidfile $PIDFILE --exec $DAEMON $DAEMON  >> /var/log/kafka/kafka.log 2>&1
end script